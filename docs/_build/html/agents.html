

<!DOCTYPE html>
<html class="writer-html5" lang="fr" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Les Agents du SystÃ¨me &mdash; BDD FÃ©dÃ©rÃ©e par Agent - Documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=9edc463e" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=05dadb3a"></script>
      <script src="_static/doctools.js?v=fd6eb6e6"></script>
      <script src="_static/sphinx_highlight.js?v=6ffebe34"></script>
      <script src="_static/translations.js?v=e6b791cb"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" />
    <link rel="next" title="Protocole MCP (Model Context Protocol)" href="mcp_protocol.html" />
    <link rel="prev" title="Architecture du SystÃ¨me" href="architecture.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="index.html" class="icon icon-home">
            BDD FÃ©dÃ©rÃ©e par Agent
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" aria-label="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">ğŸ“š Contenu</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="guide_demarrage.html">Guide de DÃ©marrage</a></li>
<li class="toctree-l1"><a class="reference internal" href="guide_demarrage.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="guide_demarrage.html#configuration">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="guide_demarrage.html#demarrage-rapide-avec-docker">DÃ©marrage Rapide avec Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="guide_demarrage.html#utilisation">Utilisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="guide_demarrage.html#tests">Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="guide_demarrage.html#depannage">DÃ©pannage</a></li>
<li class="toctree-l1"><a class="reference internal" href="guide_demarrage.html#prochaines-etapes">Prochaines Ã‰tapes</a></li>
<li class="toctree-l1"><a class="reference internal" href="guide_demarrage.html#ressources-supplementaires">Ressources SupplÃ©mentaires</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture du SystÃ¨me</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html#vue-d-ensemble">Vue dâ€™Ensemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html#composants-principaux">Composants Principaux</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html#agents-specialises">Agents SpÃ©cialisÃ©s</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html#communication-mcp">Communication MCP</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html#flux-de-requete-complet">Flux de RequÃªte Complet</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html#modeles-de-donnees">ModÃ¨les de DonnÃ©es</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html#securite-validation">SÃ©curitÃ© &amp; Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html#performances">Performances</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html#voir-aussi">Voir aussi</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Les Agents du SystÃ¨me</a></li>
<li class="toctree-l1"><a class="reference internal" href="#vue-d-ensemble">Vue dâ€™Ensemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="#baseagent-classe-de-base">BaseAgent (Classe de Base)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#architecture-d-heritage">Architecture dâ€™HÃ©ritage</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#intentagent">IntentAgent</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#flux">Flux</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parametres-d-entree">ParamÃ¨tres dâ€™EntrÃ©e</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parametres-de-sortie">ParamÃ¨tres de Sortie</a></li>
<li class="toctree-l2"><a class="reference internal" href="#intentions-possibles">Intentions Possibles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prompt-utilise">Prompt UtilisÃ©</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#retrieveragent">RetrieverAgent</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">Flux</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">ParamÃ¨tres dâ€™EntrÃ©e</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">ParamÃ¨tres de Sortie</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exemple-de-schema-retourne">Exemple de SchÃ©ma RetournÃ©</a></li>
<li class="toctree-l2"><a class="reference internal" href="#communication-mcp">Communication MCP</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#sqlagent">SQLAgent</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id4">Flux</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generation-llm-primaire">GÃ©nÃ©ration LLM (Primaire)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fallback-generation-basee-regles">Fallback : GÃ©nÃ©ration BasÃ©e RÃ¨gles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">ParamÃ¨tres dâ€™EntrÃ©e</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id6">ParamÃ¨tres de Sortie</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#validatoragent">ValidatorAgent</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id7">Flux</a></li>
<li class="toctree-l2"><a class="reference internal" href="#regles-de-validation">RÃ¨gles de Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#patterns-interdits">Patterns Interdits</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id8">ParamÃ¨tres dâ€™EntrÃ©e</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id9">ParamÃ¨tres de Sortie</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#executoragent-queryrunner">ExecutorAgent (QueryRunner)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id10">Flux</a></li>
<li class="toctree-l2"><a class="reference internal" href="#execution-parallele">ExÃ©cution ParallÃ¨le</a></li>
<li class="toctree-l2"><a class="reference internal" href="#format-du-resultat">Format du RÃ©sultat</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id11">ParamÃ¨tres dâ€™EntrÃ©e</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id12">ParamÃ¨tres de Sortie</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#composeragent">ComposerAgent</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id13">Flux</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id14">Prompt UtilisÃ©</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id15">ParamÃ¨tres dâ€™EntrÃ©e</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id16">ParamÃ¨tres de Sortie</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#registry-des-agents">Registry des Agents</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#utilisation">Utilisation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#voir-aussi">Voir aussi</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcp_protocol.html">Protocole MCP (Model Context Protocol)</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcp_protocol.html#vue-d-ensemble">Vue dâ€™Ensemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcp_protocol.html#architecture-mcp">Architecture MCP</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcp_protocol.html#outils-disponibles">Outils Disponibles</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcp_protocol.html#flux-d-execution-complet">Flux dâ€™ExÃ©cution Complet</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcp_protocol.html#implementation-cote-client-orchestrateur">ImplÃ©mentation cÃ´tÃ© Client (Orchestrateur)</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcp_protocol.html#implementation-cote-server-gateway">ImplÃ©mentation cÃ´tÃ© Server (Gateway)</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcp_protocol.html#gestion-des-erreurs">Gestion des Erreurs</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcp_protocol.html#securite-mcp">SÃ©curitÃ© MCP</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcp_protocol.html#monitoring-debugging">Monitoring &amp; Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcp_protocol.html#exemples-complets">Exemples Complets</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcp_protocol.html#voir-aussi">Voir aussi</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html">RÃ©fÃ©rence API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html#endpoints-principaux">Endpoints Principaux</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html#modeles-de-donnees">ModÃ¨les de DonnÃ©es</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html#exemples-d-utilisation">Exemples dâ€™Utilisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html#gestion-des-erreurs">Gestion des Erreurs</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html#authentification-futur">Authentification (Futur)</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html#rate-limiting">Rate Limiting</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html#voir-aussi">Voir aussi</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">RÃ©fÃ©rence des Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html#orchestrateur">Orchestrateur</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html#mcp-gateway">MCP Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html#query-management">Query Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html#tests">Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html#voir-aussi">Voir aussi</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html">DÃ©ploiement en Production</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html#prerequis">PrÃ©requis</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html#architectures-supportees">Architectures SupportÃ©es</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html#deploiement-local-avec-docker">DÃ©ploiement Local avec Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html#deploiement-kubernetes">DÃ©ploiement Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html#deploiement-cloud-cloud-run">DÃ©ploiement Cloud (Cloud Run)</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html#monitoring-logs">Monitoring &amp; Logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html#maintenance">Maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html#depannage-deploiement">DÃ©pannage DÃ©ploiement</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html#certificats-ssl-tls">Certificats SSL/TLS</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html#optimisations-performance">Optimisations Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html#checklist-de-deploiement">Checklist de DÃ©ploiement</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html#voir-aussi">Voir aussi</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ (Questions FrÃ©quemment PosÃ©es)</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html#installation-configuration">Installation &amp; Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html#deploiement">DÃ©ploiement</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html#api-requetes">API &amp; RequÃªtes</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html#agents-modeles">Agents &amp; ModÃ¨les</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html#bases-de-donnees">Bases de DonnÃ©es</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html#performance-scalabilite">Performance &amp; ScalabilitÃ©</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html#depannage">DÃ©pannage</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html#developpement">DÃ©veloppement</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html#documentation">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html#support-ressources">Support &amp; Ressources</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html#voir-aussi">Voir aussi</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">BDD FÃ©dÃ©rÃ©e par Agent - Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BDD FÃ©dÃ©rÃ©e par Agent</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Les Agents du SystÃ¨me</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/agents.rst.txt" rel="nofollow"> Afficher la source de la page</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="les-agents-du-systeme">
<h1>Les Agents du SystÃ¨me<a class="headerlink" href="#les-agents-du-systeme" title="Lien vers cette rubrique">ïƒ</a></h1>
</section>
<section id="vue-d-ensemble">
<h1>Vue dâ€™Ensemble<a class="headerlink" href="#vue-d-ensemble" title="Lien vers cette rubrique">ïƒ</a></h1>
<p>Le systÃ¨me RAG fÃ©dÃ©rÃ© utilise 6 agents spÃ©cialisÃ©s, chacun responsable dâ€™une tÃ¢che spÃ©cifique dans le pipeline.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Agent Registry &amp; Pool                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”œâ”€ IntentAgent          â—„â”€â”€â”€ Analyse intention
â”œâ”€ RetrieverAgent       â—„â”€â”€â”€ RÃ©cupÃ¨re schÃ©mas
â”œâ”€ SQLAgent             â—„â”€â”€â”€ GÃ©nÃ¨re SQL
â”œâ”€ ValidatorAgent       â—„â”€â”€â”€ Valide SQL
â”œâ”€ ExecutorAgent        â—„â”€â”€â”€ ExÃ©cute requÃªtes
â””â”€ ComposerAgent        â—„â”€â”€â”€ Compose rÃ©ponses
</pre></div>
</div>
</section>
<section id="baseagent-classe-de-base">
<h1>BaseAgent (Classe de Base)<a class="headerlink" href="#baseagent-classe-de-base" title="Lien vers cette rubrique">ïƒ</a></h1>
<p>Tous les agents hÃ©ritent de <code class="docutils literal notranslate"><span class="pre">BaseAgent</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@abstractmethod</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BaseAgent</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Classe abstraite pour tous les agents RAG.</span>

<span class="sd">    ResponsabilitÃ©s:</span>
<span class="sd">    - Initialiser un modÃ¨le de langage (Ollama)</span>
<span class="sd">    - Fournir une interface run() pour le traitement</span>
<span class="sd">    - GÃ©rer les erreurs et logging</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialiser l&#39;agent.</span>

<span class="sd">        @param config: Configuration de l&#39;agent</span>
<span class="sd">            - ollama_base_url: URL du serveur Ollama</span>
<span class="sd">            - model: Nom du modÃ¨le Ollama</span>
<span class="sd">            - temperature: TempÃ©rature (0-1)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">llm</span> <span class="o">=</span> <span class="n">ChatOllama</span><span class="p">(</span>
            <span class="n">base_url</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ollama_base_url&#39;</span><span class="p">),</span>
            <span class="n">model</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;mistral&#39;</span><span class="p">),</span>
            <span class="n">temperature</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;temperature&#39;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">QueryState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ExÃ©cuter l&#39;agent.</span>

<span class="sd">        @param state: Ã‰tat courant du pipeline</span>
<span class="sd">        @return: Mise Ã  jour de l&#39;Ã©tat</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</pre></div>
</div>
<section id="architecture-d-heritage">
<h2>Architecture dâ€™HÃ©ritage<a class="headerlink" href="#architecture-d-heritage" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   BaseAgent      â”‚
â”‚  (abstract)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                               â”‚                 â”‚       â”‚
   â–¼                               â–¼                 â–¼       â–¼
IntentAgent              RetrieverAgent         SQLAgent   ValidatorAgent
ComposerAgent                 ExecutorAgent
</pre></div>
</div>
</section>
</section>
<section id="intentagent">
<h1>IntentAgent<a class="headerlink" href="#intentagent" title="Lien vers cette rubrique">ïƒ</a></h1>
<p><strong>ResponsabilitÃ©</strong> : Classifier lâ€™intention de la requÃªte utilisateur.</p>
<p><strong>Location</strong> : <code class="docutils literal notranslate"><span class="pre">orchestrateur/src/agents/intent_agent.py</span></code></p>
<section id="flux">
<h2>Flux<a class="headerlink" href="#flux" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>RequÃªte utilisateur
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Prompt d&#39;analyse d&#39;intention â”‚
â”‚ - Intention: ?               â”‚
â”‚ - EntitÃ©s: ?                 â”‚
â”‚ - Bases concernÃ©es: ?        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Appel ChatOllama          â”‚
â”‚ (ModÃ¨le de langage local)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
Parsing rÃ©ponse LLM
       â”‚
       â–¼
state[&#39;intent&#39;] = &quot;general_knowledge&quot; | &quot;sql_query&quot; | &quot;analysis&quot;
state[&#39;entities&#39;] = {...}
state[&#39;databases&#39;] = [...]
</pre></div>
</div>
</section>
<section id="parametres-d-entree">
<h2>ParamÃ¨tres dâ€™EntrÃ©e<a class="headerlink" href="#parametres-d-entree" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">]</span>      <span class="c1"># RequÃªte utilisateur (obligatoire)</span>
</pre></div>
</div>
</section>
<section id="parametres-de-sortie">
<h2>ParamÃ¨tres de Sortie<a class="headerlink" href="#parametres-de-sortie" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;intent&#39;</span><span class="p">]</span>     <span class="c1"># Type: str - L&#39;intention dÃ©tectÃ©e</span>
<span class="n">state</span><span class="p">[</span><span class="s1">&#39;entities&#39;</span><span class="p">]</span>   <span class="c1"># Type: dict - EntitÃ©s extraites</span>
<span class="n">state</span><span class="p">[</span><span class="s1">&#39;databases&#39;</span><span class="p">]</span>  <span class="c1"># Type: list - Bases concernÃ©es</span>
</pre></div>
</div>
</section>
<section id="intentions-possibles">
<h2>Intentions Possibles<a class="headerlink" href="#intentions-possibles" title="Lien vers cette rubrique">ïƒ</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 50.0%" />
<col style="width: 25.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Intention</p></th>
<th class="head"><p>Exemple</p></th>
<th class="head"><p>NÃ©cessite BD</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>general_knowledge</p></td>
<td><p>Quelle est la capitale de la France?</p></td>
<td><p>Non</p></td>
</tr>
<tr class="row-odd"><td><p>sql_query</p></td>
<td><p>Liste tous les employÃ©s du dÃ©partement IT</p></td>
<td><p>Oui</p></td>
</tr>
<tr class="row-even"><td><p>analysis</p></td>
<td><p>Analysez les tendances de vente 2025</p></td>
<td><p>Probablement</p></td>
</tr>
</tbody>
</table>
</section>
<section id="prompt-utilise">
<h2>Prompt UtilisÃ©<a class="headerlink" href="#prompt-utilise" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Analyse la requÃªte suivante et dÃ©termine:
1. L&#39;intention (general_knowledge, sql_query, ou analysis)
2. Les entitÃ©s nommÃ©es (personnes, lieux, dates, etc.)
3. Les bases de donnÃ©es probablement concernÃ©es

RequÃªte: {query}

RÃ©ponds au format JSON:
{
    &quot;intent&quot;: &quot;...&quot;,
    &quot;entities&quot;: {...},
    &quot;databases&quot;: [...]
}
</pre></div>
</div>
</section>
</section>
<section id="retrieveragent">
<h1>RetrieverAgent<a class="headerlink" href="#retrieveragent" title="Lien vers cette rubrique">ïƒ</a></h1>
<p><strong>ResponsabilitÃ©</strong> : RÃ©cupÃ©rer les schÃ©mas des bases de donnÃ©es via MCP.</p>
<p><strong>Location</strong> : <code class="docutils literal notranslate"><span class="pre">orchestrateur/src/agents/retriever_agent.py</span></code></p>
<section id="id1">
<h2>Flux<a class="headerlink" href="#id1" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Intention + Bases concernÃ©es
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ItÃ©ration sur les bases     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Appel MCP via Gateway      â”‚
â”‚   (SSE â†’ PostgreSQL)         â”‚
â”‚   Tool: list_schemas         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RÃ©cupÃ©ration des colonnes    â”‚
â”‚ pour chaque table            â”‚
â”‚ Tool: get_schema             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
state[&#39;schemas&#39;] = {
    &#39;db1&#39;: {
        &#39;table1&#39;: {...},
        &#39;table2&#39;: {...}
    }
}
</pre></div>
</div>
</section>
<section id="id2">
<h2>ParamÃ¨tres dâ€™EntrÃ©e<a class="headerlink" href="#id2" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;databases&#39;</span><span class="p">]</span>  <span class="c1"># Bases Ã  interroger (de IntentAgent)</span>
</pre></div>
</div>
</section>
<section id="id3">
<h2>ParamÃ¨tres de Sortie<a class="headerlink" href="#id3" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;schemas&#39;</span><span class="p">]</span>    <span class="c1"># Type: dict - SchÃ©mas rÃ©cupÃ©rÃ©s</span>
</pre></div>
</div>
</section>
<section id="exemple-de-schema-retourne">
<h2>Exemple de SchÃ©ma RetournÃ©<a class="headerlink" href="#exemple-de-schema-retourne" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;employees&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;columns&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="s1">&#39;nullable&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;varchar&#39;</span><span class="p">,</span> <span class="s1">&#39;nullable&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;varchar&#39;</span><span class="p">,</span> <span class="s1">&#39;nullable&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;department_id&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="s1">&#39;nullable&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
        <span class="p">],</span>
        <span class="s1">&#39;primary_key&#39;</span><span class="p">:</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
        <span class="s1">&#39;foreign_keys&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;column&#39;</span><span class="p">:</span> <span class="s1">&#39;department_id&#39;</span><span class="p">,</span> <span class="s1">&#39;references&#39;</span><span class="p">:</span> <span class="s1">&#39;departments.id&#39;</span><span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="communication-mcp">
<h2>Communication MCP<a class="headerlink" href="#communication-mcp" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Appel MCP pour lister les schÃ©mas</span>
<span class="n">schemas</span> <span class="o">=</span> <span class="k">await</span> <span class="n">mcp_client</span><span class="o">.</span><span class="n">call_tool</span><span class="p">(</span>
    <span class="s1">&#39;list_schemas&#39;</span><span class="p">,</span>
    <span class="p">{</span><span class="s1">&#39;database&#39;</span><span class="p">:</span> <span class="s1">&#39;public&#39;</span><span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Appel MCP pour obtenir une table spÃ©cifique</span>
<span class="n">table_schema</span> <span class="o">=</span> <span class="k">await</span> <span class="n">mcp_client</span><span class="o">.</span><span class="n">call_tool</span><span class="p">(</span>
    <span class="s1">&#39;get_schema&#39;</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="s1">&#39;database&#39;</span><span class="p">:</span> <span class="s1">&#39;public&#39;</span><span class="p">,</span>
        <span class="s1">&#39;table&#39;</span><span class="p">:</span> <span class="s1">&#39;employees&#39;</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="sqlagent">
<h1>SQLAgent<a class="headerlink" href="#sqlagent" title="Lien vers cette rubrique">ïƒ</a></h1>
<p><strong>ResponsabilitÃ©</strong> : GÃ©nÃ©rer les requÃªtes SQL basÃ©es sur lâ€™intention et les schÃ©mas.</p>
<p><strong>Location</strong> : <code class="docutils literal notranslate"><span class="pre">orchestrateur/src/agents/sql_agent.py</span></code></p>
<section id="id4">
<h2>Flux<a class="headerlink" href="#id4" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Intention + EntitÃ©s + SchÃ©mas
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Construction contexte       â”‚
â”‚  pour le LLM                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GÃ©nÃ©ration LLM (primaire)  â”‚
â”‚   Prompt avec schÃ©mas        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
[Succes?]â”€â”€NOâ”€â”€â–¶ Fallback: GÃ©nÃ©ration basÃ©e rÃ¨gles
       â”‚
      YES
       â”‚
       â–¼
state[&#39;sql_queries&#39;] = {
    &#39;db1&#39;: &#39;SELECT ...&#39;,
    &#39;db2&#39;: &#39;SELECT ...&#39;
}
</pre></div>
</div>
</section>
<section id="generation-llm-primaire">
<h2>GÃ©nÃ©ration LLM (Primaire)<a class="headerlink" href="#generation-llm-primaire" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">prompt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Sur la base de la requÃªte utilisateur et du schÃ©ma fourni,</span>
<span class="s2">gÃ©nÃ¨re une requÃªte SQL sÃ©curisÃ©e.</span>

<span class="s2">SchÃ©ma:</span>
<span class="s2">{schÃ©mas formatÃ©s}</span>

<span class="s2">RequÃªte utilisateur: </span><span class="si">{requÃªte}</span>

<span class="s2">Contraintes:</span>
<span class="s2">- RequÃªte SELECT uniquement</span>
<span class="s2">- Pas de JOIN complexes sans besoin</span>
<span class="s2">- Commentaires explicatifs dans la requÃªte</span>

<span class="s2">RÃ©ponse au format JSON:</span>
<span class="s2">{&quot;sql_query&quot;: &quot;...&quot;}</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</section>
<section id="fallback-generation-basee-regles">
<h2>Fallback : GÃ©nÃ©ration BasÃ©e RÃ¨gles<a class="headerlink" href="#fallback-generation-basee-regles" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">generate_rule_based</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="n">entities</span><span class="p">,</span> <span class="n">schemas</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    GÃ©nÃ©rer une requÃªte SQL basÃ©e sur des rÃ¨gles</span>
<span class="sd">    si le LLM Ã©choue.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">intent</span> <span class="o">==</span> <span class="s1">&#39;list_all&#39;</span><span class="p">:</span>
        <span class="n">table</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">schemas</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> LIMIT 100;&quot;</span>

    <span class="k">elif</span> <span class="n">intent</span> <span class="o">==</span> <span class="s1">&#39;search&#39;</span><span class="p">:</span>
        <span class="c1"># Construire une requÃªte de recherche simple</span>
        <span class="o">...</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Intent non supportÃ©: </span><span class="si">{</span><span class="n">intent</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id5">
<h2>ParamÃ¨tres dâ€™EntrÃ©e<a class="headerlink" href="#id5" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;intent&#39;</span><span class="p">]</span>     <span class="c1"># Intention de la requÃªte</span>
<span class="n">state</span><span class="p">[</span><span class="s1">&#39;entities&#39;</span><span class="p">]</span>   <span class="c1"># EntitÃ©s extraites</span>
<span class="n">state</span><span class="p">[</span><span class="s1">&#39;schemas&#39;</span><span class="p">]</span>    <span class="c1"># SchÃ©mas des bases</span>
<span class="n">state</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">]</span>      <span class="c1"># RequÃªte originale</span>
</pre></div>
</div>
</section>
<section id="id6">
<h2>ParamÃ¨tres de Sortie<a class="headerlink" href="#id6" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;sql_queries&#39;</span><span class="p">]</span>    <span class="c1"># Type: dict[str, str] - SQL gÃ©nÃ©rÃ©e</span>
</pre></div>
</div>
</section>
</section>
<section id="validatoragent">
<h1>ValidatorAgent<a class="headerlink" href="#validatoragent" title="Lien vers cette rubrique">ïƒ</a></h1>
<p><strong>ResponsabilitÃ©</strong> : Valider la sÃ©curitÃ© et la correction syntaxique des requÃªtes SQL.</p>
<p><strong>Location</strong> : <code class="docutils literal notranslate"><span class="pre">orchestrateur/src/agents/validator_agent.py</span></code></p>
<section id="id7">
<h2>Flux<a class="headerlink" href="#id7" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>RequÃªtes SQL gÃ©nÃ©rÃ©es
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validation Syntaxe           â”‚
â”‚ - Parsage SQL                â”‚
â”‚ - VÃ©rification tokens        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validation SÃ©curitÃ©          â”‚
â”‚ - Longueur &lt; 10000 chars     â”‚
â”‚ - Pas de DROP/TRUNCATE/etc   â”‚
â”‚ - Pas de UNION ALL           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
state[&#39;validation_results&#39;] = {
    &#39;db1&#39;: {&#39;valid&#39;: True},
    &#39;db2&#39;: {&#39;valid&#39;: False, &#39;error&#39;: &#39;...&#39;}
}
</pre></div>
</div>
</section>
<section id="regles-de-validation">
<h2>RÃ¨gles de Validation<a class="headerlink" href="#regles-de-validation" title="Lien vers cette rubrique">ïƒ</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 26.7%" />
<col style="width: 53.3%" />
<col style="width: 20.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>RÃ¨gle</p></th>
<th class="head"><p>DÃ©tail</p></th>
<th class="head"><p>Critique</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Syntaxe SQL</p></td>
<td><p>VÃ©rifier parsage valide</p></td>
<td><p>Oui</p></td>
</tr>
<tr class="row-odd"><td><p>Longueur</p></td>
<td><p>&lt; 10000 caractÃ¨res</p></td>
<td><p>Oui</p></td>
</tr>
<tr class="row-even"><td><p>Commandes interdites</p></td>
<td><p>DROP, TRUNCATE, EXEC, etc.</p></td>
<td><p>Oui</p></td>
</tr>
<tr class="row-odd"><td><p>UNION</p></td>
<td><p>Pas de UNION ALL</p></td>
<td><p>Oui</p></td>
</tr>
<tr class="row-even"><td><p>Temps dâ€™exÃ©cution</p></td>
<td><p>Estimation &lt; 30s</p></td>
<td><p>Non</p></td>
</tr>
</tbody>
</table>
</section>
<section id="patterns-interdits">
<h2>Patterns Interdits<a class="headerlink" href="#patterns-interdits" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">DANGEROUS_PATTERNS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="sa">r</span><span class="s1">&#39;DROP\s+(TABLE|DATABASE)&#39;</span><span class="p">,</span>
    <span class="sa">r</span><span class="s1">&#39;TRUNCATE&#39;</span><span class="p">,</span>
    <span class="sa">r</span><span class="s1">&#39;DELETE.*FROM.*WHERE&#39;</span><span class="p">,</span>
    <span class="sa">r</span><span class="s1">&#39;UPDATE.*SET&#39;</span><span class="p">,</span>
    <span class="sa">r</span><span class="s1">&#39;INSERT\s+INTO&#39;</span><span class="p">,</span>
    <span class="sa">r</span><span class="s1">&#39;CREATE\s+TABLE&#39;</span><span class="p">,</span>
    <span class="sa">r</span><span class="s1">&#39;ALTER\s+TABLE&#39;</span><span class="p">,</span>
    <span class="sa">r</span><span class="s1">&#39;EXECUTE|EXEC&#39;</span><span class="p">,</span>
    <span class="sa">r</span><span class="s1">&#39;DECLARE.*CURSOR&#39;</span><span class="p">,</span>
    <span class="sa">r</span><span class="s1">&#39;;.*--.*DROP&#39;</span><span class="p">,</span>  <span class="c1"># Commentaires cachÃ©s</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="id8">
<h2>ParamÃ¨tres dâ€™EntrÃ©e<a class="headerlink" href="#id8" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;sql_queries&#39;</span><span class="p">]</span>    <span class="c1"># RequÃªtes Ã  valider</span>
</pre></div>
</div>
</section>
<section id="id9">
<h2>ParamÃ¨tres de Sortie<a class="headerlink" href="#id9" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;validation_results&#39;</span><span class="p">]</span>     <span class="c1"># Type: dict[str, dict]</span>
</pre></div>
</div>
</section>
</section>
<section id="executoragent-queryrunner">
<h1>ExecutorAgent (QueryRunner)<a class="headerlink" href="#executoragent-queryrunner" title="Lien vers cette rubrique">ïƒ</a></h1>
<p><strong>ResponsabilitÃ©</strong> : ExÃ©cuter les requÃªtes SQL validÃ©es via MCP.</p>
<p><strong>Location</strong> : <code class="docutils literal notranslate"><span class="pre">orchestrateur/src/executor/query_runner.py</span></code></p>
<section id="id10">
<h2>Flux<a class="headerlink" href="#id10" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>RequÃªtes SQL validÃ©es
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ItÃ©ration sur requÃªtes      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Appel MCP en parallÃ¨le      â”‚
â”‚  Tool: execute_sql           â”‚
â”‚  Database: db1, db2, ...     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Collecte rÃ©sultats SSE      â”‚
â”‚  Gestion erreurs             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
state[&#39;execution_results&#39;] = {
    &#39;db1&#39;: {
        &#39;success&#39;: True,
        &#39;rows&#39;: [...],
        &#39;count&#39;: 42,
        &#39;execution_time&#39;: 0.125
    }
}
</pre></div>
</div>
</section>
<section id="execution-parallele">
<h2>ExÃ©cution ParallÃ¨le<a class="headerlink" href="#execution-parallele" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_federated</span><span class="p">(</span><span class="n">sql_queries</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ExÃ©cuter plusieurs requÃªtes en parallÃ¨le.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">execute_via_mcp</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">sql</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">db</span><span class="p">,</span> <span class="n">sql</span> <span class="ow">in</span> <span class="n">sql_queries</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">]</span>

    <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">,</span> <span class="n">return_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="n">db</span><span class="p">:</span> <span class="n">result</span>
        <span class="k">for</span> <span class="n">db</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sql_queries</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">results</span><span class="p">)</span>
    <span class="p">}</span>
</pre></div>
</div>
</section>
<section id="format-du-resultat">
<h2>Format du RÃ©sultat<a class="headerlink" href="#format-du-resultat" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>           <span class="c1"># BoolÃ©en</span>
    <span class="s1">&#39;rows&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span><span class="s1">&#39;col1&#39;</span><span class="p">:</span> <span class="s1">&#39;val1&#39;</span><span class="p">,</span> <span class="s1">&#39;col2&#39;</span><span class="p">:</span> <span class="s1">&#39;val2&#39;</span><span class="p">},</span>
        <span class="o">...</span>
    <span class="p">],</span>
    <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>               <span class="c1"># Nombre de lignes</span>
    <span class="s1">&#39;execution_time&#39;</span><span class="p">:</span> <span class="mf">0.125</span><span class="p">,</span>   <span class="c1"># Secondes</span>
    <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="kc">None</span>              <span class="c1"># Message erreur ou None</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id11">
<h2>ParamÃ¨tres dâ€™EntrÃ©e<a class="headerlink" href="#id11" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;sql_queries&#39;</span><span class="p">]</span>              <span class="c1"># RequÃªtes Ã  exÃ©cuter</span>
<span class="n">state</span><span class="p">[</span><span class="s1">&#39;validation_results&#39;</span><span class="p">]</span>       <span class="c1"># RÃ©sultats validation</span>
</pre></div>
</div>
</section>
<section id="id12">
<h2>ParamÃ¨tres de Sortie<a class="headerlink" href="#id12" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;execution_results&#39;</span><span class="p">]</span>        <span class="c1"># Type: dict</span>
</pre></div>
</div>
</section>
</section>
<section id="composeragent">
<h1>ComposerAgent<a class="headerlink" href="#composeragent" title="Lien vers cette rubrique">ïƒ</a></h1>
<p><strong>ResponsabilitÃ©</strong> : Composer une rÃ©ponse en langage naturel Ã  partir des rÃ©sultats.</p>
<p><strong>Location</strong> : <code class="docutils literal notranslate"><span class="pre">orchestrateur/src/agents/composer_agent.py</span></code></p>
<section id="id13">
<h2>Flux<a class="headerlink" href="#id13" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Intention + RequÃªte + RÃ©sultats
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PrÃ©paration contexte LLM    â”‚
â”‚  - RÃ©sultats formatÃ©s        â”‚
â”‚  - RequÃªte originale         â”‚
â”‚  - Intention                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Appel ChatOllama            â”‚
â”‚  (Composition naturelle)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
state[&#39;final_output&#39;] = &quot;RÃ©ponse naturelle...&quot;
</pre></div>
</div>
</section>
<section id="id14">
<h2>Prompt UtilisÃ©<a class="headerlink" href="#id14" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>BasÃ© sur les rÃ©sultats suivants, rÃ©ponse Ã  la question
de l&#39;utilisateur de maniÃ¨re concise et naturelle.

RequÃªte originale: {query}

RÃ©sultats obtenus:
{results_formatted}

Remarques:
- Soyez concis et clair
- Utilisez le franÃ§ais
- Si aucun rÃ©sultat, expliquez-le
- Ã‰vitez de montrer le SQL
</pre></div>
</div>
</section>
<section id="id15">
<h2>ParamÃ¨tres dâ€™EntrÃ©e<a class="headerlink" href="#id15" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">]</span>                  <span class="c1"># RequÃªte originale</span>
<span class="n">state</span><span class="p">[</span><span class="s1">&#39;intent&#39;</span><span class="p">]</span>                 <span class="c1"># Intention</span>
<span class="n">state</span><span class="p">[</span><span class="s1">&#39;execution_results&#39;</span><span class="p">]</span>      <span class="c1"># RÃ©sultats exÃ©cution</span>
<span class="n">state</span><span class="p">[</span><span class="s1">&#39;final_output&#39;</span><span class="p">]</span>           <span class="c1"># RÃ©ponse</span>
</pre></div>
</div>
</section>
<section id="id16">
<h2>ParamÃ¨tres de Sortie<a class="headerlink" href="#id16" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;final_output&#39;</span><span class="p">]</span>           <span class="c1"># Type: str - RÃ©ponse finale</span>
</pre></div>
</div>
</section>
</section>
<section id="registry-des-agents">
<h1>Registry des Agents<a class="headerlink" href="#registry-des-agents" title="Lien vers cette rubrique">ïƒ</a></h1>
<p>Le <code class="docutils literal notranslate"><span class="pre">AgentRegistry</span></code> gÃ¨re lâ€™instanciation et lâ€™accÃ¨s Ã  tous les agents.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">AgentRegistry</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Registre centralisÃ© des agents.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialiser tous les agents.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">agents</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;intent&#39;</span><span class="p">:</span> <span class="n">IntentAgent</span><span class="p">(</span><span class="n">config</span><span class="p">),</span>
            <span class="s1">&#39;retriever&#39;</span><span class="p">:</span> <span class="n">RetrieverAgent</span><span class="p">(</span><span class="n">config</span><span class="p">),</span>
            <span class="s1">&#39;sql&#39;</span><span class="p">:</span> <span class="n">SQLAgent</span><span class="p">(</span><span class="n">config</span><span class="p">),</span>
            <span class="s1">&#39;validator&#39;</span><span class="p">:</span> <span class="n">ValidatorAgent</span><span class="p">(</span><span class="n">config</span><span class="p">),</span>
            <span class="s1">&#39;executor&#39;</span><span class="p">:</span> <span class="n">ExecutorAgent</span><span class="p">(</span><span class="n">config</span><span class="p">),</span>
            <span class="s1">&#39;composer&#39;</span><span class="p">:</span> <span class="n">ComposerAgent</span><span class="p">(</span><span class="n">config</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;RÃ©cupÃ©rer un agent par nom.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">agent_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Agent inconnu: </span><span class="si">{</span><span class="n">agent_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">[</span><span class="n">agent_name</span><span class="p">]</span>
</pre></div>
</div>
<section id="utilisation">
<h2>Utilisation<a class="headerlink" href="#utilisation" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># CrÃ©er le registre</span>
<span class="n">registry</span> <span class="o">=</span> <span class="n">AgentRegistry</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

<span class="c1"># Utiliser dans le pipeline</span>
<span class="n">intent_agent</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">get_agent</span><span class="p">(</span><span class="s1">&#39;intent&#39;</span><span class="p">)</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">intent_agent</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="voir-aussi">
<h1>Voir aussi<a class="headerlink" href="#voir-aussi" title="Lien vers cette rubrique">ïƒ</a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="architecture.html"><span class="doc">Architecture du SystÃ¨me</span></a> pour le flux global</p></li>
<li><p><a class="reference internal" href="api_reference.html"><span class="doc">RÃ©fÃ©rence API</span></a> pour les endpoints</p></li>
<li><p><a class="reference internal" href="mcp_protocol.html"><span class="doc">Protocole MCP (Model Context Protocol)</span></a> pour la communication</p></li>
</ul>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pied de page">
        <a href="architecture.html" class="btn btn-neutral float-left" title="Architecture du SystÃ¨me" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> PrÃ©cÃ©dent</a>
        <a href="mcp_protocol.html" class="btn btn-neutral float-right" title="Protocole MCP (Model Context Protocol)" accesskey="n" rel="next">Suivant <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Droits d'auteur 2026, PROCOM Team.</p>
  </div>

  CompilÃ© avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thÃ¨me</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>