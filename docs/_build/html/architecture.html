

<!DOCTYPE html>
<html class="writer-html5" lang="fr" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Architecture du SystÃ¨me &mdash; BDD FÃ©dÃ©rÃ©e par Agent - Documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=9edc463e" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=05dadb3a"></script>
      <script src="_static/doctools.js?v=fd6eb6e6"></script>
      <script src="_static/sphinx_highlight.js?v=6ffebe34"></script>
      <script src="_static/translations.js?v=e6b791cb"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" />
    <link rel="next" title="Les Agents du SystÃ¨me" href="agents.html" />
    <link rel="prev" title="Guide de DÃ©marrage" href="guide_demarrage.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="index.html" class="icon icon-home">
            BDD FÃ©dÃ©rÃ©e par Agent
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" aria-label="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">ğŸ“š Contenu</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="guide_demarrage.html">Guide de DÃ©marrage</a></li>
<li class="toctree-l1"><a class="reference internal" href="guide_demarrage.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="guide_demarrage.html#configuration">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="guide_demarrage.html#demarrage-rapide-avec-docker">DÃ©marrage Rapide avec Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="guide_demarrage.html#utilisation">Utilisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="guide_demarrage.html#tests">Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="guide_demarrage.html#depannage">DÃ©pannage</a></li>
<li class="toctree-l1"><a class="reference internal" href="guide_demarrage.html#prochaines-etapes">Prochaines Ã‰tapes</a></li>
<li class="toctree-l1"><a class="reference internal" href="guide_demarrage.html#ressources-supplementaires">Ressources SupplÃ©mentaires</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Architecture du SystÃ¨me</a></li>
<li class="toctree-l1"><a class="reference internal" href="#vue-d-ensemble">Vue dâ€™Ensemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="#composants-principaux">Composants Principaux</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#orchestrateur-fastapi">Orchestrateur (FastAPI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline-langgraph">Pipeline LangGraph</a></li>
<li class="toctree-l2"><a class="reference internal" href="#etat-du-systeme-querystate">Ã‰tat du SystÃ¨me (QueryState)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#agents-specialises">Agents SpÃ©cialisÃ©s</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#architecture-agent">Architecture Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="#flux-par-agent">Flux par Agent</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#intentagent">IntentAgent</a></li>
<li class="toctree-l3"><a class="reference internal" href="#retrieveragent">RetrieverAgent</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sqlagent">SQLAgent</a></li>
<li class="toctree-l3"><a class="reference internal" href="#validatoragent">ValidatorAgent</a></li>
<li class="toctree-l3"><a class="reference internal" href="#executoragent">ExecutorAgent</a></li>
<li class="toctree-l3"><a class="reference internal" href="#composeragent">ComposerAgent</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#communication-mcp">Communication MCP</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#passerelle-mcp">Passerelle MCP</a></li>
<li class="toctree-l2"><a class="reference internal" href="#flux-de-communication">Flux de Communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="#outils-mcp-disponibles">Outils MCP Disponibles</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#flux-de-requete-complet">Flux de RequÃªte Complet</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#etape-1-reception">Ã‰tape 1 : RÃ©ception</a></li>
<li class="toctree-l2"><a class="reference internal" href="#etape-2-pipeline">Ã‰tape 2 : Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="#etape-3-reponse">Ã‰tape 3 : RÃ©ponse</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#modeles-de-donnees">ModÃ¨les de DonnÃ©es</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#queryrequest">QueryRequest</a></li>
<li class="toctree-l2"><a class="reference internal" href="#queryresponse">QueryResponse</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#securite-validation">SÃ©curitÃ© &amp; Validation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#strategies-de-securite">StratÃ©gies de SÃ©curitÃ©</a></li>
<li class="toctree-l2"><a class="reference internal" href="#validation-sql">Validation SQL</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#performances">Performances</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#optimisations">Optimisations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#metriques">MÃ©triques</a></li>
<li class="toctree-l2"><a class="reference internal" href="#scalabilite">ScalabilitÃ©</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#voir-aussi">Voir aussi</a></li>
<li class="toctree-l1"><a class="reference internal" href="agents.html">Les Agents du SystÃ¨me</a></li>
<li class="toctree-l1"><a class="reference internal" href="agents.html#vue-d-ensemble">Vue dâ€™Ensemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="agents.html#baseagent-classe-de-base">BaseAgent (Classe de Base)</a></li>
<li class="toctree-l1"><a class="reference internal" href="agents.html#intentagent">IntentAgent</a></li>
<li class="toctree-l1"><a class="reference internal" href="agents.html#retrieveragent">RetrieverAgent</a></li>
<li class="toctree-l1"><a class="reference internal" href="agents.html#sqlagent">SQLAgent</a></li>
<li class="toctree-l1"><a class="reference internal" href="agents.html#validatoragent">ValidatorAgent</a></li>
<li class="toctree-l1"><a class="reference internal" href="agents.html#executoragent-queryrunner">ExecutorAgent (QueryRunner)</a></li>
<li class="toctree-l1"><a class="reference internal" href="agents.html#composeragent">ComposerAgent</a></li>
<li class="toctree-l1"><a class="reference internal" href="agents.html#registry-des-agents">Registry des Agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="agents.html#voir-aussi">Voir aussi</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcp_protocol.html">Protocole MCP (Model Context Protocol)</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcp_protocol.html#vue-d-ensemble">Vue dâ€™Ensemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcp_protocol.html#architecture-mcp">Architecture MCP</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcp_protocol.html#outils-disponibles">Outils Disponibles</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcp_protocol.html#flux-d-execution-complet">Flux dâ€™ExÃ©cution Complet</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcp_protocol.html#implementation-cote-client-orchestrateur">ImplÃ©mentation cÃ´tÃ© Client (Orchestrateur)</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcp_protocol.html#implementation-cote-server-gateway">ImplÃ©mentation cÃ´tÃ© Server (Gateway)</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcp_protocol.html#gestion-des-erreurs">Gestion des Erreurs</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcp_protocol.html#securite-mcp">SÃ©curitÃ© MCP</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcp_protocol.html#monitoring-debugging">Monitoring &amp; Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcp_protocol.html#exemples-complets">Exemples Complets</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcp_protocol.html#voir-aussi">Voir aussi</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html">RÃ©fÃ©rence API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html#endpoints-principaux">Endpoints Principaux</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html#modeles-de-donnees">ModÃ¨les de DonnÃ©es</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html#exemples-d-utilisation">Exemples dâ€™Utilisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html#gestion-des-erreurs">Gestion des Erreurs</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html#authentification-futur">Authentification (Futur)</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html#rate-limiting">Rate Limiting</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html#voir-aussi">Voir aussi</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">RÃ©fÃ©rence des Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html#orchestrateur">Orchestrateur</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html#mcp-gateway">MCP Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html#query-management">Query Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html#tests">Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html#voir-aussi">Voir aussi</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html">DÃ©ploiement en Production</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html#prerequis">PrÃ©requis</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html#architectures-supportees">Architectures SupportÃ©es</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html#deploiement-local-avec-docker">DÃ©ploiement Local avec Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html#deploiement-kubernetes">DÃ©ploiement Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html#deploiement-cloud-cloud-run">DÃ©ploiement Cloud (Cloud Run)</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html#monitoring-logs">Monitoring &amp; Logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html#maintenance">Maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html#depannage-deploiement">DÃ©pannage DÃ©ploiement</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html#certificats-ssl-tls">Certificats SSL/TLS</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html#optimisations-performance">Optimisations Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html#checklist-de-deploiement">Checklist de DÃ©ploiement</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html#voir-aussi">Voir aussi</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ (Questions FrÃ©quemment PosÃ©es)</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html#installation-configuration">Installation &amp; Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html#deploiement">DÃ©ploiement</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html#api-requetes">API &amp; RequÃªtes</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html#agents-modeles">Agents &amp; ModÃ¨les</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html#bases-de-donnees">Bases de DonnÃ©es</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html#performance-scalabilite">Performance &amp; ScalabilitÃ©</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html#depannage">DÃ©pannage</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html#developpement">DÃ©veloppement</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html#documentation">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html#support-ressources">Support &amp; Ressources</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html#voir-aussi">Voir aussi</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">BDD FÃ©dÃ©rÃ©e par Agent - Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BDD FÃ©dÃ©rÃ©e par Agent</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Architecture du SystÃ¨me</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/architecture.rst.txt" rel="nofollow"> Afficher la source de la page</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="architecture-du-systeme">
<h1>Architecture du SystÃ¨me<a class="headerlink" href="#architecture-du-systeme" title="Lien vers cette rubrique">ïƒ</a></h1>
</section>
<section id="vue-d-ensemble">
<h1>Vue dâ€™Ensemble<a class="headerlink" href="#vue-d-ensemble" title="Lien vers cette rubrique">ïƒ</a></h1>
<p>Le systÃ¨me est architecturÃ© en microservices conteneurisÃ©s avec une communication par WebSocket et MCP.</p>
</section>
<section id="composants-principaux">
<h1>Composants Principaux<a class="headerlink" href="#composants-principaux" title="Lien vers cette rubrique">ïƒ</a></h1>
<section id="orchestrateur-fastapi">
<h2>Orchestrateur (FastAPI)<a class="headerlink" href="#orchestrateur-fastapi" title="Lien vers cette rubrique">ïƒ</a></h2>
<p><strong>Location</strong> : <code class="docutils literal notranslate"><span class="pre">orchestrateur/main.py</span></code></p>
<p><strong>ResponsabilitÃ©s</strong> :</p>
<ul class="simple">
<li><p>RÃ©ception des requÃªtes utilisateur</p></li>
<li><p>Orchestration du pipeline LangGraph</p></li>
<li><p>Gestion des Ã©tats et transitions</p></li>
<li><p>RÃ©ponse avec rÃ©sultats finaux</p></li>
</ul>
<p><strong>Points dâ€™EntrÃ©e</strong> :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">query</span>          <span class="c1"># Traiter une requÃªte</span>
<span class="n">GET</span>  <span class="o">/</span><span class="n">health</span>            <span class="c1"># VÃ©rifier la santÃ© du service</span>
</pre></div>
</div>
</section>
<section id="pipeline-langgraph">
<h2>Pipeline LangGraph<a class="headerlink" href="#pipeline-langgraph" title="Lien vers cette rubrique">ïƒ</a></h2>
<p><strong>Location</strong> : <code class="docutils literal notranslate"><span class="pre">orchestrateur/src/orchestrator/orchestrator.py</span></code></p>
<p><strong>Architecture</strong> :</p>
<p>Le pipeline utilise LangGraph avec un graphe dâ€™Ã©tats dÃ©fini :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚   START     â”‚
 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚  Intent Agent    â”‚ â—„â”€â”€â”€ Analyse l&#39;intention de la requÃªte
 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ Retriever Agent  â”‚ â—„â”€â”€â”€ RÃ©cupÃ¨re les schÃ©mas des BDD
 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚   SQL Agent      â”‚ â—„â”€â”€â”€ GÃ©nÃ¨re les requÃªtes SQL
 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ Validator Agent  â”‚ â—„â”€â”€â”€ Valide les requÃªtes SQL
 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
   [Conditionnel]
   /    |     \
  âœ“     âœ—     ?
 â”‚      â”‚      â”‚
 â–¼      â–¼      â–¼
EXEC  ERREUR RETRY
 â”‚      â”‚
 â–¼      â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ Execute Agent    â”‚ â—„â”€â”€â”€ ExÃ©cute les requÃªtes en fÃ©dÃ©rÃ©
 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ Composer Agent   â”‚ â—„â”€â”€â”€ Compose la rÃ©ponse finale
 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚     END     â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre></div>
</div>
</section>
<section id="etat-du-systeme-querystate">
<h2>Ã‰tat du SystÃ¨me (QueryState)<a class="headerlink" href="#etat-du-systeme-querystate" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">QueryState</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Ã‰tat partagÃ© du pipeline&quot;&quot;&quot;</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span>                           <span class="c1"># RequÃªte utilisateur</span>
    <span class="n">intent</span><span class="p">:</span> <span class="nb">str</span>                          <span class="c1"># Intention dÃ©tectÃ©e</span>
    <span class="n">schemas</span><span class="p">:</span> <span class="nb">dict</span>                        <span class="c1"># SchÃ©mas des BDD</span>
    <span class="n">sql_queries</span><span class="p">:</span> <span class="nb">dict</span>                    <span class="c1"># RequÃªtes SQL gÃ©nÃ©rÃ©es</span>
    <span class="n">validation_results</span><span class="p">:</span> <span class="nb">dict</span>             <span class="c1"># RÃ©sultats validation</span>
    <span class="n">execution_results</span><span class="p">:</span> <span class="nb">dict</span>              <span class="c1"># RÃ©sultats exÃ©cution</span>
    <span class="n">final_output</span><span class="p">:</span> <span class="nb">str</span>                    <span class="c1"># RÃ©ponse finale</span>
    <span class="n">errors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>                    <span class="c1"># Erreurs accumulÃ©es</span>
</pre></div>
</div>
</section>
</section>
<section id="agents-specialises">
<h1>Agents SpÃ©cialisÃ©s<a class="headerlink" href="#agents-specialises" title="Lien vers cette rubrique">ïƒ</a></h1>
<section id="architecture-agent">
<h2>Architecture Agent<a class="headerlink" href="#architecture-agent" title="Lien vers cette rubrique">ïƒ</a></h2>
<p>Tous les agents hÃ©ritent de <code class="docutils literal notranslate"><span class="pre">BaseAgent</span></code> et implÃ©mentent une mÃ©thode <code class="docutils literal notranslate"><span class="pre">run()</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">BaseAgent</span> <span class="p">(</span><span class="n">abstract</span><span class="p">)</span>
<span class="err">â”‚</span>
<span class="err">â”œâ”€</span> <span class="n">IntentAgent</span>       <span class="c1"># Classification intention</span>
<span class="err">â”œâ”€</span> <span class="n">RetrieverAgent</span>    <span class="c1"># RÃ©cupÃ©ration schÃ©mas</span>
<span class="err">â”œâ”€</span> <span class="n">SQLAgent</span>          <span class="c1"># GÃ©nÃ©ration SQL</span>
<span class="err">â”œâ”€</span> <span class="n">ValidatorAgent</span>    <span class="c1"># Validation SQL</span>
<span class="err">â””â”€</span> <span class="n">ComposerAgent</span>     <span class="c1"># Composition rÃ©ponse</span>
</pre></div>
</div>
</section>
<section id="flux-par-agent">
<h2>Flux par Agent<a class="headerlink" href="#flux-par-agent" title="Lien vers cette rubrique">ïƒ</a></h2>
<section id="intentagent">
<h3>IntentAgent<a class="headerlink" href="#intentagent" title="Lien vers cette rubrique">ïƒ</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>RequÃªte utilisateur
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Analyse LLM     â”‚
â”‚ (Intent Match)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
{intent, entities, databases}
</pre></div>
</div>
</section>
<section id="retrieveragent">
<h3>RetrieverAgent<a class="headerlink" href="#retrieveragent" title="Lien vers cette rubrique">ïƒ</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Liste des bases Ã  interroger
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Appel MCP       â”‚
â”‚ (RÃ©cupÃ©ration)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
{schemas: {db1: {...}, db2: {...}}}
</pre></div>
</div>
</section>
<section id="sqlagent">
<h3>SQLAgent<a class="headerlink" href="#sqlagent" title="Lien vers cette rubrique">ïƒ</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Intention + SchÃ©mas
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GÃ©nÃ©ration LLM   â”‚
â”‚  (Fallback: RB)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
{sql_queries: {db1: &quot;SELECT...&quot;, db2: &quot;...&quot;}}
</pre></div>
</div>
</section>
<section id="validatoragent">
<h3>ValidatorAgent<a class="headerlink" href="#validatoragent" title="Lien vers cette rubrique">ïƒ</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>RequÃªtes SQL
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validation       â”‚
â”‚ (Structure+Len)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
{validation_results: {db1: {valid: true}, db2: {valid: true}}}
</pre></div>
</div>
</section>
<section id="executoragent">
<h3>ExecutorAgent<a class="headerlink" href="#executoragent" title="Lien vers cette rubrique">ïƒ</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>RequÃªtes SQL validÃ©es
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ExÃ©cution MCP   â”‚
â”‚  (FÃ©dÃ©rÃ©e)       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
{execution_results: {db1: {...}, db2: {...}}}
</pre></div>
</div>
</section>
<section id="composeragent">
<h3>ComposerAgent<a class="headerlink" href="#composeragent" title="Lien vers cette rubrique">ïƒ</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>RÃ©sultats exÃ©cution
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Composition LLM  â”‚
â”‚ (Langage nat.)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
&quot;RÃ©ponse naturelle...&quot;
</pre></div>
</div>
</section>
</section>
</section>
<section id="communication-mcp">
<h1>Communication MCP<a class="headerlink" href="#communication-mcp" title="Lien vers cette rubrique">ïƒ</a></h1>
<section id="passerelle-mcp">
<h2>Passerelle MCP<a class="headerlink" href="#passerelle-mcp" title="Lien vers cette rubrique">ïƒ</a></h2>
<p><strong>Location</strong> : <code class="docutils literal notranslate"><span class="pre">mcp/mcp-gateway/</span></code></p>
<p><strong>RÃ´le</strong> :</p>
<ul class="simple">
<li><p>Serveur FastAPI avec WebSocket</p></li>
<li><p>Pool de clients MCP (un par serveur de base de donnÃ©es)</p></li>
<li><p>Routage des requÃªtes outils et ressources</p></li>
</ul>
</section>
<section id="flux-de-communication">
<h2>Flux de Communication<a class="headerlink" href="#flux-de-communication" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Orchestrateur  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ WebSocket
         â”‚ {&quot;method&quot;: &quot;call_tool&quot;, &quot;tool&quot;: &quot;execute_sql&quot;, ...}
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MCP Gateway     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ SSE
         â”‚ {&quot;method&quot;: &quot;call_tool&quot;, ...}
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MCP Server     â”‚
â”‚ (PostgreSQL)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ RÃ©sultat
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Base de DonnÃ©esâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre></div>
</div>
</section>
<section id="outils-mcp-disponibles">
<h2>Outils MCP Disponibles<a class="headerlink" href="#outils-mcp-disponibles" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;tools&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;execute_sql&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ExÃ©cute une requÃªte SQL&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;inputSchema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;sql&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">},</span>
<span class="w">          </span><span class="nt">&quot;database&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;list_schemas&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Liste les schÃ©mas disponibles&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;get_schema&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RÃ©cupÃ¨re le schÃ©ma d&#39;une table&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="flux-de-requete-complet">
<h1>Flux de RequÃªte Complet<a class="headerlink" href="#flux-de-requete-complet" title="Lien vers cette rubrique">ïƒ</a></h1>
<section id="etape-1-reception">
<h2>Ã‰tape 1 : RÃ©ception<a class="headerlink" href="#etape-1-reception" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>POST<span class="w"> </span>/api/query
Content-Type:<span class="w"> </span>application/json
<span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;query&quot;</span>:<span class="w"> </span><span class="s2">&quot;Quelle est la capitale de la France?&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
</section>
<section id="etape-2-pipeline">
<h2>Ã‰tape 2 : Pipeline<a class="headerlink" href="#etape-2-pipeline" title="Lien vers cette rubrique">ïƒ</a></h2>
<ol class="arabic simple">
<li><p><strong>Intent Analysis</strong> (IntentAgent)
- DÃ©terminer : gÃ©nÃ©ral / base de donnÃ©es
- Extraire entitÃ©s
- Identifier bases concernÃ©es</p></li>
<li><p><strong>Schema Retrieval</strong> (RetrieverAgent)
- Appeler MCP pour schÃ©mas
- Contextualiser pour LLM</p></li>
<li><p><strong>SQL Generation</strong> (SQLAgent)
- GÃ©nÃ©rer requÃªtes SQL
- Validation syntaxe basique</p></li>
<li><p><strong>SQL Validation</strong> (ValidatorAgent)
- VÃ©rifier structure
- VÃ©rifier longueur (sÃ©curitÃ©)</p></li>
<li><p><strong>Execution</strong> (QueryRunner)
- ExÃ©cuter via MCP (fÃ©dÃ©rÃ©)
- RÃ©cupÃ©rer rÃ©sultats</p></li>
<li><p><strong>Response Composition</strong> (ComposerAgent)
- GÃ©nÃ©rer rÃ©ponse naturelle
- Contextualiser rÃ©sultats</p></li>
</ol>
</section>
<section id="etape-3-reponse">
<h2>Ã‰tape 3 : RÃ©ponse<a class="headerlink" href="#etape-3-reponse" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;request_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;550e8400-e29b-41d4-a716-446655440000&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Quelle est la capitale de la France?&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;intent&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;general_knowledge&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;completed&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;final_output&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;La capitale de la France est Paris.&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;execution_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.23</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;agents_used&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;intent&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;composer&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;databases_queried&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="modeles-de-donnees">
<h1>ModÃ¨les de DonnÃ©es<a class="headerlink" href="#modeles-de-donnees" title="Lien vers cette rubrique">ïƒ</a></h1>
<section id="queryrequest">
<h2>QueryRequest<a class="headerlink" href="#queryrequest" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">QueryRequest</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;RequÃªte entrante&quot;&quot;&quot;</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span>                  <span class="c1"># RequÃªte utilisateur</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>      <span class="c1"># Contexte optionnel</span>
    <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>       <span class="c1"># Limite rÃ©sultats</span>
</pre></div>
</div>
</section>
<section id="queryresponse">
<h2>QueryResponse<a class="headerlink" href="#queryresponse" title="Lien vers cette rubrique">ïƒ</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">QueryResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;RÃ©ponse du systÃ¨me&quot;&quot;&quot;</span>
    <span class="n">request_id</span><span class="p">:</span> <span class="nb">str</span>             <span class="c1"># ID unique</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span>                  <span class="c1"># RequÃªte originale</span>
    <span class="n">intent</span><span class="p">:</span> <span class="nb">str</span>                 <span class="c1"># Intention dÃ©tectÃ©e</span>
    <span class="n">status</span><span class="p">:</span> <span class="nb">str</span>                 <span class="c1"># completed/error/timeout</span>
    <span class="n">final_output</span><span class="p">:</span> <span class="nb">str</span>           <span class="c1"># RÃ©ponse finale</span>
    <span class="n">execution_time</span><span class="p">:</span> <span class="nb">float</span>       <span class="c1"># Temps en secondes</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span>              <span class="c1"># MÃ©tadonnÃ©es additionnelles</span>
</pre></div>
</div>
</section>
</section>
<section id="securite-validation">
<h1>SÃ©curitÃ© &amp; Validation<a class="headerlink" href="#securite-validation" title="Lien vers cette rubrique">ïƒ</a></h1>
<section id="strategies-de-securite">
<h2>StratÃ©gies de SÃ©curitÃ©<a class="headerlink" href="#strategies-de-securite" title="Lien vers cette rubrique">ïƒ</a></h2>
<ol class="arabic simple">
<li><p><strong>SQL Injection Prevention</strong>
- Validation syntaxe SQL
- VÃ©rification longueur
- Parameterized queries (MCP)</p></li>
<li><p><strong>Access Control</strong>
- Authentification API (Ã  venir)
- Autorisation par base de donnÃ©es</p></li>
<li><p><strong>Rate Limiting</strong>
- Limiter requÃªtes par utilisateur
- Limiter temps exÃ©cution</p></li>
<li><p><strong>Error Handling</strong>
- Ne pas exposer dÃ©tails BD
- Logs sÃ©curisÃ©s</p></li>
</ol>
</section>
<section id="validation-sql">
<h2>Validation SQL<a class="headerlink" href="#validation-sql" title="Lien vers cette rubrique">ïƒ</a></h2>
<p>Le ValidatorAgent vÃ©rifie :</p>
<ul class="simple">
<li><p>Syntaxe SQL valide</p></li>
<li><p>Longueur raisonnable (&lt; 10000 caractÃ¨res)</p></li>
<li><p>Pas de patterns dangereux (DROP, TRUNCATE, etc.)</p></li>
</ul>
</section>
</section>
<section id="performances">
<h1>Performances<a class="headerlink" href="#performances" title="Lien vers cette rubrique">ïƒ</a></h1>
<section id="optimisations">
<h2>Optimisations<a class="headerlink" href="#optimisations" title="Lien vers cette rubrique">ïƒ</a></h2>
<ol class="arabic simple">
<li><p><strong>Async/Await</strong> : RequÃªtes non-bloquantes</p></li>
<li><p><strong>MCP Pooling</strong> : RÃ©utilisation connexions</p></li>
<li><p><strong>Caching</strong> : SchÃ©mas en cache</p></li>
<li><p><strong>Parallelisation</strong> : ExÃ©cution fÃ©dÃ©rÃ©e en parallÃ¨le</p></li>
</ol>
</section>
<section id="metriques">
<h2>MÃ©triques<a class="headerlink" href="#metriques" title="Lien vers cette rubrique">ïƒ</a></h2>
<ul class="simple">
<li><p>Temps moyen requÃªte : ~1-2 secondes</p></li>
<li><p>Throughput : ~100 req/min par instance</p></li>
<li><p>Latence MCP : ~100-200ms</p></li>
</ul>
</section>
<section id="scalabilite">
<h2>ScalabilitÃ©<a class="headerlink" href="#scalabilite" title="Lien vers cette rubrique">ïƒ</a></h2>
<ul class="simple">
<li><p>Orchestrateur : Stateless (scale horizontalement)</p></li>
<li><p>MCP Gateway : Pool de connexions (scale verticalement)</p></li>
<li><p>Bases de donnÃ©es : FÃ©dÃ©ration (indÃ©pendantes)</p></li>
</ul>
</section>
</section>
<section id="voir-aussi">
<h1>Voir aussi<a class="headerlink" href="#voir-aussi" title="Lien vers cette rubrique">ïƒ</a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="agents.html"><span class="doc">Les Agents du SystÃ¨me</span></a> pour dÃ©tails des agents</p></li>
<li><p><a class="reference internal" href="mcp_protocol.html"><span class="doc">Protocole MCP (Model Context Protocol)</span></a> pour le protocole MCP</p></li>
<li><p><a class="reference internal" href="api_reference.html"><span class="doc">RÃ©fÃ©rence API</span></a> pour les endpoints</p></li>
</ul>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pied de page">
        <a href="guide_demarrage.html" class="btn btn-neutral float-left" title="Guide de DÃ©marrage" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> PrÃ©cÃ©dent</a>
        <a href="agents.html" class="btn btn-neutral float-right" title="Les Agents du SystÃ¨me" accesskey="n" rel="next">Suivant <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Droits d'auteur 2026, PROCOM Team.</p>
  </div>

  CompilÃ© avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thÃ¨me</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>